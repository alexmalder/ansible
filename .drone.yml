---
kind: pipeline
type: kubernetes
name: default

steps:
- name: lint
  image: alpine:3.17
  commands:
  - cp roles/init/files/etc/apk/repositories /etc/apk/repositories
  - apk update
  - apk upgrade
  - apk add py3-pip
  - pip install ansible-lint
  - ansible-lint *.yml
  when:
    branch:
      - master
    event:
      - push 

- name: test init alpine
  image: alpine:3.17
  commands:
    - apk add ansible
    - ansible-playbook init.yml
  when:
    branch:
      - master
    event:
      - push 
