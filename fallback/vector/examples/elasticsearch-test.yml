---
sources:
  nginx_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - nginx

  openldap_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - openldap

  openvpn_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - openvpn

  openvpn_gost_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - openvpn-gost

  stunnel_gost_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - stunnel-gost

  mysql_mysqld_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - mysql-mysqld

  mysql_slow_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - mysql-slow

  dockerhost_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - dockerhost

  k8s_kafka_source:
    type: kafka
    bootstrap_servers: "{{ kafka_bootstrap_servers }}"
    group_id: vector
    topics:
      - k8s

transforms:
  nginx_kafka_transform:
    type: "json_parser"
    inputs: 
      - nginx_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  openldap_kafka_transform:
    type: "json_parser"
    inputs: 
      - openldap_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  openvpn_kafka_transform:
    type: "json_parser"
    inputs: 
      - openvpn_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  openvpn_gost_kafka_transform:
    type: "json_parser"
    inputs: 
      - openvpn_gost_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  stunnel_gost_kafka_transform:
    type: "json_parser"
    inputs: 
      - stunnel_gost_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  mysql_mysqld_kafka_transform:
    type: "json_parser"
    inputs: 
      - mysql_mysqld_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  mysql_slow_kafka_transform:
    type: "json_parser"
    inputs: 
      - mysql_slow_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  dockerhost_kafka_transform:
    type: "json_parser"
    inputs: 
      - dockerhost_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

  k8s_kafka_transform:
    type: "json_parser"
    inputs: 
      - k8s_kafka_source
    drop_invalid: true
    drop_field: true
    field: message

sinks:
  nginx_kafka_sink:
    type: elasticsearch
    inputs:
      - nginx_kafka_transform
    bulk:
      index: "vector-nginx-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  openldap_kafka_sink:
    type: elasticsearch
    inputs:
      - openldap_kafka_transform
    bulk:
      index: "vector-openldap-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  openvpn_kafka_sink:
    type: elasticsearch
    inputs:
      - openvpn_kafka_transform
    bulk:
      index: "vector-openvpn-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  openvpn_gost_kafka_sink:
    type: elasticsearch
    inputs:
      - openvpn_gost_kafka_transform
    bulk:
      index: "vector-openvpn-gost-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  stunnel_gost_kafka_sink:
    type: elasticsearch
    inputs:
      - stunnel_gost_kafka_transform
    bulk:
      index: "vector-stunnel-gost-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  mysql_mysqld_kafka_sink:
    type: elasticsearch
    inputs:
      - mysql_mysqld_kafka_transform
    bulk:
      index: "vector-mysql-mysqld-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  mysql_slow_kafka_sink:
    type: elasticsearch
    inputs:
      - mysql_slow_kafka_transform
    bulk:
      index: "vector-mysql-slow-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  dockerhost_kafka_sink:
    type: elasticsearch
    inputs:
      - dockerhost_kafka_transform
    bulk:
      index: "vector-dockerhost-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true

  k8s_kafka_sink:
    type: elasticsearch
    inputs:
      - k8s_kafka_transform
    bulk:
      index: "vector-k8s-%Y-%m-%d"
    endpoint: "{{ vector_elasticsearch_url }}"
    mode: bulk
    compression: none
    healthcheck:
      enabled: true
