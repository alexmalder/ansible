CREATE TABLE auditbeat_queue (
    `@metadata_beat` String,
    `@metadata_type` String,
    `@metadata_version` String,
    `agent_ephemeral_id` String,
    `agent_id` String,
    `agent_name` String,
    `agent_type` String,
    `agent_version` String,
    `auditd_data_a0` String,
    `auditd_data_a1` String,
    `auditd_data_a2` String,
    `auditd_data_a3` String,
    `auditd_data_acct` String,
    `auditd_data_addr` String,
    `auditd_data_arch` String,
    `auditd_data_auid` String,
    `auditd_data_cipher` String,
    `auditd_data_cmd` String,
    `auditd_data_default-context` String,
    `auditd_data_dev` String,
    `auditd_data_direction` String,
    `auditd_data_entries` String,
    `auditd_data_exit` String,
    `auditd_data_family` String,
    `auditd_data_fp` String,
    `auditd_data_gid` String,
    `auditd_data_grantors` String,
    `auditd_data_hostname` String,
    `auditd_data_id` String,
    `auditd_data_kind` String,
    `auditd_data_ksize` String,
    `auditd_data_laddr` String,
    `auditd_data_lport` String,
    `auditd_data_mac` String,
    `auditd_data_old-ses` String,
    `auditd_data_old_prom` String,
    `auditd_data_op` String,
    `auditd_data_pfs` String,
    `auditd_data_prom` String,
    `auditd_data_rport` String,
    `auditd_data_selected-context` String,
    `auditd_data_ses` String,
    `auditd_data_spid` String,
    `auditd_data_subj_domain` String,
    `auditd_data_subj_level` String,
    `auditd_data_subj_role` String,
    `auditd_data_subj_user` String,
    `auditd_data_syscall` String,
    `auditd_data_table` String,
    `auditd_data_terminal` String,
    `auditd_data_tty` String,
    `auditd_data_uid` String,
    `auditd_data_unit` String,
    `auditd_message_type` String,
    `auditd_result` String,
    `auditd_sequence` Int64,
    `auditd_session` String,
    `auditd_summary_actor_primary` String,
    `auditd_summary_actor_secondary` String,
    `auditd_summary_how` String,
    `auditd_summary_object_primary` String,
    `auditd_summary_object_secondary` String,
    `auditd_summary_object_type` String,
    `client_bytes` Int64,
    `client_domain` String,
    `client_ip` String,
    `client_packets` Int64,
    `client_port` Int64,
    `container_id` String,
    `container_image_name` String,
    `container_labels_architecture` String,
    `container_labels_build-date` String,
    `container_labels_com_docker_compose_config-hash` String,
    `container_labels_com_docker_compose_container-number` String,
    `container_labels_com_docker_compose_depends_on` String,
    `container_labels_com_docker_compose_image` String,
    `container_labels_com_docker_compose_oneoff` String,
    `container_labels_com_docker_compose_project` String,
    `container_labels_com_docker_compose_project_config_files` String,
    `container_labels_com_docker_compose_project_working_dir` String,
    `container_labels_com_docker_compose_service` String,
    `container_labels_com_docker_compose_version` String,
    `container_labels_com_gitlab_gitlab-runner_job_before_sha` String,
    `container_labels_com_gitlab_gitlab-runner_job_id` String,
    `container_labels_com_gitlab_gitlab-runner_job_ref` String,
    `container_labels_com_gitlab_gitlab-runner_job_sha` String,
    `container_labels_com_gitlab_gitlab-runner_job_url` String,
    `container_labels_com_gitlab_gitlab-runner_managed` String,
    `container_labels_com_gitlab_gitlab-runner_pipeline_id` String,
    `container_labels_com_gitlab_gitlab-runner_project_id` String,
    `container_labels_com_gitlab_gitlab-runner_runner_id` String,
    `container_labels_com_gitlab_gitlab-runner_runner_local_id` String,
    `container_labels_com_gitlab_gitlab-runner_type` String,
    `container_labels_com_nvidia_cudnn_version` String,
    `container_labels_com_redhat_build-host` String,
    `container_labels_com_redhat_component` String,
    `container_labels_com_redhat_license_terms` String,
    `container_labels_description` String,
    `container_labels_distribution-scope` String,
    `container_labels_io_k8s_description` String,
    `container_labels_io_k8s_display-name` String,
    `container_labels_io_openshift_expose-services` String,
    `container_labels_io_openshift_tags` String,
    `container_labels_io_rancher_cni_link_mtu_overhead` String,
    `container_labels_io_rancher_cni_network` String,
    `container_labels_io_rancher_cni_wait` String,
    `container_labels_io_rancher_container_agent_id` String,
    `container_labels_io_rancher_container_agent_role` String,
    `container_labels_io_rancher_container_agent_service_drain_provider` String,
    `container_labels_io_rancher_container_agent_service_ipsec` String,
    `container_labels_io_rancher_container_agent_service_metadata` String,
    `container_labels_io_rancher_container_agent_service_scheduling` String,
    `container_labels_io_rancher_container_create_agent` String,
    `container_labels_io_rancher_container_dns` String,
    `container_labels_io_rancher_container_hostname_override` String,
    `container_labels_io_rancher_container_ip` String,
    `container_labels_io_rancher_container_mac_address` String,
    `container_labels_io_rancher_container_name` String,
    `container_labels_io_rancher_container_pull_image` String,
    `container_labels_io_rancher_container_system` String,
    `container_labels_io_rancher_container_uuid` String,
    `container_labels_io_rancher_environment_uuid` String,
    `container_labels_io_rancher_network_arpsync` String,
    `container_labels_io_rancher_network_cni_binary` String,
    `container_labels_io_rancher_network_macsync` String,
    `container_labels_io_rancher_project_name` String,
    `container_labels_io_rancher_project_service_name` String,
    `container_labels_io_rancher_scheduler_global` String,
    `container_labels_io_rancher_service_deployment_unit` String,
    `container_labels_io_rancher_service_hash` String,
    `container_labels_io_rancher_service_launch_config` String,
    `container_labels_io_rancher_service_requested_host_id` String,
    `container_labels_io_rancher_sidekicks` String,
    `container_labels_io_rancher_stack_name` String,
    `container_labels_io_rancher_stack_service_name` String,
    `container_labels_maintainer` String,
    `container_labels_name` String,
    `container_labels_org_opencontainers_image_created` String,
    `container_labels_org_opencontainers_image_description` String,
    `container_labels_org_opencontainers_image_licenses` String,
    `container_labels_org_opencontainers_image_revision` String,
    `container_labels_org_opencontainers_image_source` String,
    `container_labels_org_opencontainers_image_title` String,
    `container_labels_org_opencontainers_image_url` String,
    `container_labels_org_opencontainers_image_version` String,
    `container_labels_release` String,
    `container_labels_summary` String,
    `container_labels_url` String,
    `container_labels_vcs-ref` String,
    `container_labels_vcs-type` String,
    `container_labels_vendor` String,
    `container_labels_version` String,
    `container_name` String,
    `destination_bytes` Int64,
    `destination_domain` String,
    `destination_ip` String,
    `destination_packets` Int64,
    `destination_port` Int64,
    `ecs_version` String,
    `error_message` String,
    `event_action` String,
    `event_category` String,
    `event_dataset` String,
    `event_duration` Int64,
    `event_end` String,
    `event_id` String,
    `event_kind` String,
    `event_module` String,
    `event_origin` String,
    `event_outcome` String,
    `event_start` String,
    `event_type` String,
    `file_ctime` String,
    `file_extension` String,
    `file_gid` String,
    `file_group` String,
    `file_hash_sha1` String,
    `file_inode` String,
    `file_mime_type` String,
    `file_mode` String,
    `file_mtime` String,
    `file_owner` String,
    `file_path` String,
    `file_size` Int64,
    `file_type` String,
    `file_uid` String,
    `flow_complete` Int8,
    `flow_final` Int8,
    `group_id` String,
    `group_name` String,
    `host_architecture` String,
    `host_containerized` Int8,
    `host_hostname` String,
    `host_id` String,
    `host_ip` String,
    `host_mac` String,
    `host_name` String,
    `host_os_codename` String,
    `host_os_family` String,
    `host_os_kernel` String,
    `host_os_name` String,
    `host_os_platform` String,
    `host_os_type` String,
    `host_os_version` String,
    `network_bytes` Int64,
    `network_community_id` String,
    `network_direction` String,
    `network_packets` Int64,
    `network_transport` String,
    `network_type` String,
    `package_architecture` String,
    `package_description` String,
    `package_installed` String,
    `package_license` String,
    `package_name` String,
    `package_reference` String,
    `package_size` Int64,
    `package_type` String,
    `package_version` String,
    `process_args` String,
    `process_created` String,
    `process_entity_id` String,
    `process_executable` String,
    `process_hash_sha1` String,
    `process_name` String,
    `process_parent_pid` Int64,
    `process_pid` Int64,
    `process_start` String,
    `process_title` String,
    `process_working_directory` String,
    `related_ip` String,
    `related_user` String,
    `server_bytes` Int64,
    `server_domain` String,
    `server_ip` String,
    `server_packets` Int64,
    `server_port` Int64,
    `service_type` String,
    `source_bytes` Int64,
    `source_domain` String,
    `source_ip` String,
    `source_packets` Int64,
    `source_port` Int64,
    `system_audit_host_architecture` String,
    `system_audit_host_boottime` String,
    `system_audit_host_containerized` Int8,
    `system_audit_host_hostname` String,
    `system_audit_host_id` String,
    `system_audit_host_ip` String,
    `system_audit_host_mac` String,
    `system_audit_host_os_codename` String,
    `system_audit_host_os_family` String,
    `system_audit_host_os_kernel` String,
    `system_audit_host_os_name` String,
    `system_audit_host_os_platform` String,
    `system_audit_host_os_type` String,
    `system_audit_host_os_version` String,
    `system_audit_host_timezone.name` String,
    `system_audit_host_timezone.offset.sec` Int64,
    `system_audit_host_uptime` Int64,
    `system_audit_package_arch` String,
    `system_audit_package_entity_id` String,
    `system_audit_package_installtime` String,
    `system_audit_package_license` String,
    `system_audit_package_name` String,
    `system_audit_package_release` String,
    `system_audit_package_size` Int64,
    `system_audit_package_summary` String,
    `system_audit_package_url` String,
    `system_audit_package_version` String,
    `system_audit_socket_egid` Int64,
    `system_audit_socket_euid` Int64,
    `system_audit_socket_gid` Int64,
    `system_audit_socket_kernel_sock_address` String,
    `system_audit_socket_uid` Int64,
    `system_audit_user_dir` String,
    `system_audit_user_gid` String,
    `system_audit_user_group` String,
    `system_audit_user_name` String,
    `system_audit_user_password_last_changed` String,
    `system_audit_user_password_type` String,
    `system_audit_user_shell` String,
    `system_audit_user_uid` String,
    `system_audit_user_user_information` String,
    `user_audit_id` String,
    `user_audit_name` String,
    `user_effective_group_id` String,
    `user_effective_id` String,
    `user_effective_name` String,
    `user_entity_id` String,
    `user_filesystem_group_id` String,
    `user_filesystem_group_name` String,
    `user_filesystem_id` String,
    `user_filesystem_name` String,
    `user_group_id` String,
    `user_group_name` String,
    `user_id` Int64,
    `user_name` String,
    `user_saved_group_id` String,
    `user_saved_group_name` String,
    `user_saved_id` String,
    `user_saved_name` String,
    `user_selinux_category` String,
    `user_selinux_domain` String,
    `user_selinux_level` String,
    `user_selinux_role` String,
    `user_selinux_user` String,
    `user_terminal` String
) ENGINE = Kafka SETTINGS kafka_broker_list = '<kafka_broker_list>',
                            kafka_topic_list = 'auditbeat-tf',
                            kafka_group_name = 'clickhouse-auditbeat-logs',
                            kafka_format = 'JSONEachRow',
                            kafka_num_consumers = 3;

CREATE TABLE auditbeat_daily (
    `@metadata_beat` String,
    `@metadata_type` String,
    `@metadata_version` String,
    `agent_ephemeral_id` String,
    `agent_id` String,
    `agent_name` String,
    `agent_type` String,
    `agent_version` String,
    `auditd_data_a0` String,
    `auditd_data_a1` String,
    `auditd_data_a2` String,
    `auditd_data_a3` String,
    `auditd_data_acct` String,
    `auditd_data_addr` String,
    `auditd_data_arch` String,
    `auditd_data_auid` String,
    `auditd_data_cipher` String,
    `auditd_data_cmd` String,
    `auditd_data_default-context` String,
    `auditd_data_dev` String,
    `auditd_data_direction` String,
    `auditd_data_entries` String,
    `auditd_data_exit` String,
    `auditd_data_family` String,
    `auditd_data_fp` String,
    `auditd_data_gid` String,
    `auditd_data_grantors` String,
    `auditd_data_hostname` String,
    `auditd_data_id` String,
    `auditd_data_kind` String,
    `auditd_data_ksize` String,
    `auditd_data_laddr` String,
    `auditd_data_lport` String,
    `auditd_data_mac` String,
    `auditd_data_old-ses` String,
    `auditd_data_old_prom` String,
    `auditd_data_op` String,
    `auditd_data_pfs` String,
    `auditd_data_prom` String,
    `auditd_data_rport` String,
    `auditd_data_selected-context` String,
    `auditd_data_ses` String,
    `auditd_data_spid` String,
    `auditd_data_subj_domain` String,
    `auditd_data_subj_level` String,
    `auditd_data_subj_role` String,
    `auditd_data_subj_user` String,
    `auditd_data_syscall` String,
    `auditd_data_table` String,
    `auditd_data_terminal` String,
    `auditd_data_tty` String,
    `auditd_data_uid` String,
    `auditd_data_unit` String,
    `auditd_message_type` String,
    `auditd_result` String,
    `auditd_sequence` Int64,
    `auditd_session` String,
    `auditd_summary_actor_primary` String,
    `auditd_summary_actor_secondary` String,
    `auditd_summary_how` String,
    `auditd_summary_object_primary` String,
    `auditd_summary_object_secondary` String,
    `auditd_summary_object_type` String,
    `client_bytes` Int64,
    `client_domain` String,
    `client_ip` String,
    `client_packets` Int64,
    `client_port` Int64,
    `container_id` String,
    `container_image_name` String,
    `container_labels_architecture` String,
    `container_labels_build-date` String,
    `container_labels_com_docker_compose_config-hash` String,
    `container_labels_com_docker_compose_container-number` String,
    `container_labels_com_docker_compose_depends_on` String,
    `container_labels_com_docker_compose_image` String,
    `container_labels_com_docker_compose_oneoff` String,
    `container_labels_com_docker_compose_project` String,
    `container_labels_com_docker_compose_project_config_files` String,
    `container_labels_com_docker_compose_project_working_dir` String,
    `container_labels_com_docker_compose_service` String,
    `container_labels_com_docker_compose_version` String,
    `container_labels_com_gitlab_gitlab-runner_job_before_sha` String,
    `container_labels_com_gitlab_gitlab-runner_job_id` String,
    `container_labels_com_gitlab_gitlab-runner_job_ref` String,
    `container_labels_com_gitlab_gitlab-runner_job_sha` String,
    `container_labels_com_gitlab_gitlab-runner_job_url` String,
    `container_labels_com_gitlab_gitlab-runner_managed` String,
    `container_labels_com_gitlab_gitlab-runner_pipeline_id` String,
    `container_labels_com_gitlab_gitlab-runner_project_id` String,
    `container_labels_com_gitlab_gitlab-runner_runner_id` String,
    `container_labels_com_gitlab_gitlab-runner_runner_local_id` String,
    `container_labels_com_gitlab_gitlab-runner_type` String,
    `container_labels_com_nvidia_cudnn_version` String,
    `container_labels_com_redhat_build-host` String,
    `container_labels_com_redhat_component` String,
    `container_labels_com_redhat_license_terms` String,
    `container_labels_description` String,
    `container_labels_distribution-scope` String,
    `container_labels_io_k8s_description` String,
    `container_labels_io_k8s_display-name` String,
    `container_labels_io_openshift_expose-services` String,
    `container_labels_io_openshift_tags` String,
    `container_labels_io_rancher_cni_link_mtu_overhead` String,
    `container_labels_io_rancher_cni_network` String,
    `container_labels_io_rancher_cni_wait` String,
    `container_labels_io_rancher_container_agent_id` String,
    `container_labels_io_rancher_container_agent_role` String,
    `container_labels_io_rancher_container_agent_service_drain_provider` String,
    `container_labels_io_rancher_container_agent_service_ipsec` String,
    `container_labels_io_rancher_container_agent_service_metadata` String,
    `container_labels_io_rancher_container_agent_service_scheduling` String,
    `container_labels_io_rancher_container_create_agent` String,
    `container_labels_io_rancher_container_dns` String,
    `container_labels_io_rancher_container_hostname_override` String,
    `container_labels_io_rancher_container_ip` String,
    `container_labels_io_rancher_container_mac_address` String,
    `container_labels_io_rancher_container_name` String,
    `container_labels_io_rancher_container_pull_image` String,
    `container_labels_io_rancher_container_system` String,
    `container_labels_io_rancher_container_uuid` String,
    `container_labels_io_rancher_environment_uuid` String,
    `container_labels_io_rancher_network_arpsync` String,
    `container_labels_io_rancher_network_cni_binary` String,
    `container_labels_io_rancher_network_macsync` String,
    `container_labels_io_rancher_project_name` String,
    `container_labels_io_rancher_project_service_name` String,
    `container_labels_io_rancher_scheduler_global` String,
    `container_labels_io_rancher_service_deployment_unit` String,
    `container_labels_io_rancher_service_hash` String,
    `container_labels_io_rancher_service_launch_config` String,
    `container_labels_io_rancher_service_requested_host_id` String,
    `container_labels_io_rancher_sidekicks` String,
    `container_labels_io_rancher_stack_name` String,
    `container_labels_io_rancher_stack_service_name` String,
    `container_labels_maintainer` String,
    `container_labels_name` String,
    `container_labels_org_opencontainers_image_created` String,
    `container_labels_org_opencontainers_image_description` String,
    `container_labels_org_opencontainers_image_licenses` String,
    `container_labels_org_opencontainers_image_revision` String,
    `container_labels_org_opencontainers_image_source` String,
    `container_labels_org_opencontainers_image_title` String,
    `container_labels_org_opencontainers_image_url` String,
    `container_labels_org_opencontainers_image_version` String,
    `container_labels_release` String,
    `container_labels_summary` String,
    `container_labels_url` String,
    `container_labels_vcs-ref` String,
    `container_labels_vcs-type` String,
    `container_labels_vendor` String,
    `container_labels_version` String,
    `container_name` String,
    `destination_bytes` Int64,
    `destination_domain` String,
    `destination_ip` String,
    `destination_packets` Int64,
    `destination_port` Int64,
    `ecs_version` String,
    `error_message` String,
    `event_action` String,
    `event_category` String,
    `event_dataset` String,
    `event_duration` Int64,
    `event_end` String,
    `event_id` String,
    `event_kind` String,
    `event_module` String,
    `event_origin` String,
    `event_outcome` String,
    `event_start` String,
    `event_type` String,
    `file_ctime` String,
    `file_extension` String,
    `file_gid` String,
    `file_group` String,
    `file_hash_sha1` String,
    `file_inode` String,
    `file_mime_type` String,
    `file_mode` String,
    `file_mtime` String,
    `file_owner` String,
    `file_path` String,
    `file_size` Int64,
    `file_type` String,
    `file_uid` String,
    `flow_complete` Int8,
    `flow_final` Int8,
    `group_id` String,
    `group_name` String,
    `host_architecture` String,
    `host_containerized` Int8,
    `host_hostname` String,
    `host_id` String,
    `host_ip` String,
    `host_mac` String,
    `host_name` String,
    `host_os_codename` String,
    `host_os_family` String,
    `host_os_kernel` String,
    `host_os_name` String,
    `host_os_platform` String,
    `host_os_type` String,
    `host_os_version` String,
    `network_bytes` Int64,
    `network_community_id` String,
    `network_direction` String,
    `network_packets` Int64,
    `network_transport` String,
    `network_type` String,
    `package_architecture` String,
    `package_description` String,
    `package_installed` String,
    `package_license` String,
    `package_name` String,
    `package_reference` String,
    `package_size` Int64,
    `package_type` String,
    `package_version` String,
    `process_args` String,
    `process_created` String,
    `process_entity_id` String,
    `process_executable` String,
    `process_hash_sha1` String,
    `process_name` String,
    `process_parent_pid` Int64,
    `process_pid` Int64,
    `process_start` String,
    `process_title` String,
    `process_working_directory` String,
    `related_ip` String,
    `related_user` String,
    `server_bytes` Int64,
    `server_domain` String,
    `server_ip` String,
    `server_packets` Int64,
    `server_port` Int64,
    `service_type` String,
    `source_bytes` Int64,
    `source_domain` String,
    `source_ip` String,
    `source_packets` Int64,
    `source_port` Int64,
    `system_audit_host_architecture` String,
    `system_audit_host_boottime` String,
    `system_audit_host_containerized` Int8,
    `system_audit_host_hostname` String,
    `system_audit_host_id` String,
    `system_audit_host_ip` String,
    `system_audit_host_mac` String,
    `system_audit_host_os_codename` String,
    `system_audit_host_os_family` String,
    `system_audit_host_os_kernel` String,
    `system_audit_host_os_name` String,
    `system_audit_host_os_platform` String,
    `system_audit_host_os_type` String,
    `system_audit_host_os_version` String,
    `system_audit_host_timezone.name` String,
    `system_audit_host_timezone.offset.sec` Int64,
    `system_audit_host_uptime` Int64,
    `system_audit_package_arch` String,
    `system_audit_package_entity_id` String,
    `system_audit_package_installtime` String,
    `system_audit_package_license` String,
    `system_audit_package_name` String,
    `system_audit_package_release` String,
    `system_audit_package_size` Int64,
    `system_audit_package_summary` String,
    `system_audit_package_url` String,
    `system_audit_package_version` String,
    `system_audit_socket_egid` Int64,
    `system_audit_socket_euid` Int64,
    `system_audit_socket_gid` Int64,
    `system_audit_socket_kernel_sock_address` String,
    `system_audit_socket_uid` Int64,
    `system_audit_user_dir` String,
    `system_audit_user_gid` String,
    `system_audit_user_group` String,
    `system_audit_user_name` String,
    `system_audit_user_password_last_changed` String,
    `system_audit_user_password_type` String,
    `system_audit_user_shell` String,
    `system_audit_user_uid` String,
    `system_audit_user_user_information` String,
    `user_audit_id` String,
    `user_audit_name` String,
    `user_effective_group_id` String,
    `user_effective_id` String,
    `user_effective_name` String,
    `user_entity_id` String,
    `user_filesystem_group_id` String,
    `user_filesystem_group_name` String,
    `user_filesystem_id` String,
    `user_filesystem_name` String,
    `user_group_id` String,
    `user_group_name` String,
    `user_id` Int64,
    `user_name` String,
    `user_saved_group_id` String,
    `user_saved_group_name` String,
    `user_saved_id` String,
    `user_saved_name` String,
    `user_selinux_category` String,
    `user_selinux_domain` String,
    `user_selinux_level` String,
    `user_selinux_role` String,
    `user_selinux_user` String,
    `user_terminal` String,
    `timestamp` Datetime DEFAULT NOW()
) ENGINE MergeTree() PARTITION BY toYYYYMM(timestamp) ORDER BY (timestamp, process_pid) SETTINGS index_granularity=8192;

CREATE MATERIALIZED VIEW auditbeat_consumer TO auditbeat_daily 
AS SELECT *
FROM 
    auditbeat_queue;
