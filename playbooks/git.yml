---
- hosts: 127.0.0.1
  connection: local
  vars:
    gitea_url: https://git.vnmntn.com/alexmalder
    github_url: https://github.com/alexmalder
    github_remote: github
    repos:
      - ansible
      - obsidian
      - reader
      - scraper
      - store
  tasks:
    - name: Delete content & directory
      ansible.builtin.file:
        state: absent
        path: "/tmp/{{ item }}"
      with_items: "{{ repos }}"

    - name: Clone repositories into /tmp
      ansible.builtin.git:
        repo: "{{ gitea_url }}/{{ item }}"
        dest: "/tmp/{{ item }}"
        single_branch: true
        force: true
        version: master
      with_items: "{{ repos }}"

    - name: Git remote add
      ansible.builtin.command: "git -C /tmp/{{ item }} remote add {{ github_remote }} {{ github_url }}/{{ item }}"
      with_items: "{{ repos }}"

    - name: Git push
      ansible.builtin.command: "git -C /tmp/{{ item }} push -u github master"
      with_items: "{{ repos }}"
